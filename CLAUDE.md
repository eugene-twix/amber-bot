# Amber Bot

Telegram-–±–æ—Ç –¥–ª—è —É—á—ë—Ç–∞ –∫–æ–º–∞–Ω–¥ –∫–≤–∏–∑–æ–≤/–Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –∏–≥—Ä, –∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- –£—á—ë—Ç –∫–æ–º–∞–Ω–¥ –∏ –∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –í–µ–¥–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–æ–≤ —Å –¥–∞—Ç–∞–º–∏ –∏ –º–µ—Å—Ç–∞–º–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
- –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–º–µ—Å—Ç–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Ç—É—Ä–Ω–∏—Ä–∞—Ö)
- –†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –ø–æ –ø–æ–±–µ–¥–∞–º –∏ —Å—Ä–µ–¥–Ω–µ–º—É –º–µ—Å—Ç—É
- –†–æ–ª–µ–≤—É—é –º–æ–¥–µ–ª—å: viewer ‚Üí organizer ‚Üí admin

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –ß–∏—Å—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∏ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π:** –ù–µ –¥–µ–ª–∞–π –∫–æ–º–º–∏—Ç—ã –±–µ–∑ —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **–ö–æ–º–º–∏—Ç—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:** –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç `feat/fix/refactor` –∏ —Ç.–¥.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
cmd/
‚îú‚îÄ‚îÄ bot/main.go           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
‚îî‚îÄ‚îÄ migrate/main.go       # CLI –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

internal/
‚îú‚îÄ‚îÄ config/               # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ ENV
‚îú‚îÄ‚îÄ domain/               # Domain-—Å—É—â–Ω–æ—Å—Ç–∏ (User, Team, Member, Tournament, Result)
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ interfaces.go     # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îî‚îÄ‚îÄ bun/              # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Bun ORM
‚îú‚îÄ‚îÄ cache/                # Dragonfly (Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π) –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ fsm/                  # FSM –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
‚îî‚îÄ‚îÄ bot/
    ‚îú‚îÄ‚îÄ bot.go            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
    ‚îú‚îÄ‚îÄ auth.go           # Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ handlers.go       # –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    ‚îú‚îÄ‚îÄ handlers_org.go   # –ö–æ–º–∞–Ω–¥—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤
    ‚îî‚îÄ‚îÄ handlers_admin.go # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

```
Telegram Message
    ‚Üì
[internal/bot/]        ‚Üê Telebot handlers, middleware
    ‚Üì
[internal/fsm/]        ‚Üê –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ (Redis)
    ‚Üì
[internal/repository/] ‚Üê Bun ORM
    ‚Üì
PostgreSQL
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** Go 1.21+, telebot/v3, Bun ORM
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 16
- **–ö–µ—à/FSM:** Dragonfly (Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** Docker Compose

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å age (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
brew install age

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
make secrets-keygen

# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
echo "age1..." > .age-recipients  # –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á

# –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
cp .secret.env.example .secret.env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å .secret.env —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (TOKEN, DATABASE_URL, ADMIN_IDS)

# –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
make secrets-encrypt
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

```bash
docker-compose up -d
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (–º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

```bash
make run
```

## –ü–æ—Ä—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| PostgreSQL | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| Dragonfly | 6379 | Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –∫–µ—à |

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü—É–±–ª–∏—á–Ω—ã–µ (`.env`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `REDIS_URL` | URL Dragonfly/Redis | `redis://localhost:6379/0` |

### –°–µ–∫—Ä–µ—Ç–Ω—ã–µ (`.secret.env`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `TELEGRAM_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather | `123456:ABC-DEF...` |
| `DATABASE_URL` | DSN PostgreSQL | `postgres://amber:amber@localhost:5432/amber_bot?sslmode=disable` |
| `ADMIN_IDS` | Telegram ID –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | `123456789,987654321` |

## –°–µ–∫—Ä–µ—Ç—ã (age encryption)

–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é [age](https://github.com/FiloSottile/age).

### –§–∞–π–ª—ã

| –§–∞–π–ª | –í git | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `.secret.env` | –Ω–µ—Ç | –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (—Ä–∞–±–æ—á–∏–π —Ñ–∞–π–ª) |
| `.secret.enc.env` | –¥–∞ | –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã |
| `.secret.env.example` | –¥–∞ | –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ–∫—Ä–µ—Ç–æ–≤ |
| `.age-key.txt` | –Ω–µ—Ç | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (—É –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–π) |
| `.age-recipients` | –¥–∞ | –ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å age
brew install age  # macOS

# 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
make secrets-keygen
# –í—ã–≤–µ–¥–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á ‚Äî –¥–æ–±–∞–≤—å –µ–≥–æ –≤ .age-recipients

# 3. –°–æ–∑–¥–∞—Ç—å .age-recipients —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
echo "age1..." > .age-recipients

# 4. –°–æ–∑–¥–∞—Ç—å .secret.env –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
cp .secret.env.example .secret.env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

# 5. –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
make secrets-encrypt
```

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å (–ø–æ—Å–ª–µ git pull)
make secrets-decrypt

# –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å (–ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º)
make secrets-encrypt
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

1. –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á: `make secrets-keygen`
2. –ü—Ä–∏—Å—ã–ª–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (age1...)
3. –î–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ `.age-recipients` (–ø–æ –æ–¥–Ω–æ–º—É –∫–ª—é—á—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)
4. –ü–µ—Ä–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å: `make secrets-encrypt`

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
go run cmd/bot/main.go

# –ú–∏–≥—Ä–∞—Ü–∏–∏
go run cmd/migrate/main.go up      # –ø—Ä–∏–º–µ–Ω–∏—Ç—å
go run cmd/migrate/main.go down    # –æ—Ç–∫–∞—Ç–∏—Ç—å
go run cmd/migrate/main.go status  # —Å—Ç–∞—Ç—É—Å

# –°–±–æ—Ä–∫–∞
go build ./...

# –¢–µ—Å—Ç—ã
go test ./...

# –õ–∏–Ω—Ç–µ—Ä (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
golangci-lint run ./...
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

```bash
psql "postgres://amber:amber@localhost:5432/amber_bot?sslmode=disable"
```

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram —Å —Ä–æ–ª—è–º–∏ |
| `teams` | –ö–æ–º–∞–Ω–¥—ã |
| `members` | –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥ |
| `tournaments` | –¢—É—Ä–Ω–∏—Ä—ã |
| `results` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–∫–æ–º–∞–Ω–¥–∞ + —Ç—É—Ä–Ω–∏—Ä + –º–µ—Å—Ç–æ) |

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –†–æ–ª—å | –ü—Ä–∞–≤–∞ |
|------|-------|
| `viewer` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∞–Ω–¥, —Ä–µ–π—Ç–∏–Ω–≥–∞ |
| `organizer` | + —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥, —Ç—É—Ä–Ω–∏—Ä–æ–≤, –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| `admin` | + –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ SQL –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `cmd/migrate/migrations/`:

```
cmd/migrate/migrations/
‚îú‚îÄ‚îÄ 20260112000001_init.up.sql    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
‚îî‚îÄ‚îÄ 20260112000001_init.down.sql  # –û—Ç–∫–∞—Ç
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:
   ```bash
   touch cmd/migrate/migrations/YYYYMMDDHHMMSS_description.up.sql
   touch cmd/migrate/migrations/YYYYMMDDHHMMSS_description.down.sql
   ```

2. –ù–∞–ø–∏—Å–∞—Ç—å SQL —Å `IF EXISTS` / `IF NOT EXISTS` –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å: `go run cmd/migrate/main.go up`

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Reply Keyboard (–∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞) –≤–º–µ—Å—Ç–æ –∫–æ–º–∞–Ω–¥. –ú–µ–Ω—é –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### Viewer (–±–∞–∑–æ–≤–æ–µ –º–µ–Ω—é)

```
[ üìã –ö–æ–º–∞–Ω–¥—ã ] [ üèÜ –†–µ–π—Ç–∏–Ω–≥ ]
```

### Organizer (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ)

```
[ üìã –ö–æ–º–∞–Ω–¥—ã ] [ üèÜ –†–µ–π—Ç–∏–Ω–≥ ]
[ ‚ûï –ö–æ–º–∞–Ω–¥–∞ ] [ üë§ –£—á–∞—Å—Ç–Ω–∏–∫ ]
[ üéØ –¢—É—Ä–Ω–∏—Ä ] [ üìä –†–µ–∑—É–ª—å—Ç–∞—Ç ]
```

### Admin (–ø–æ–ª–Ω–æ–µ)

```
[ üìã –ö–æ–º–∞–Ω–¥—ã ] [ üèÜ –†–µ–π—Ç–∏–Ω–≥ ]
[ ‚ûï –ö–æ–º–∞–Ω–¥–∞ ] [ üë§ –£—á–∞—Å—Ç–Ω–∏–∫ ]
[ üéØ –¢—É—Ä–Ω–∏—Ä ] [ üìä –†–µ–∑—É–ª—å—Ç–∞—Ç ]
[ üëë –ü—Ä–∞–≤–∞ ]
```

### –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –º–µ–Ω—é |

–í–æ –≤—Ä–µ–º—è FSM –¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´‚ùå –û—Ç–º–µ–Ω–∞¬ª.

## FSM (Finite State Machine)

–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ FSM —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redis.

–°–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `internal/fsm/state.go`:
- `StateNewTeamName` ‚Äî –≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
- `StateAddMemberTeam` ‚Üí `StateAddMemberName` ‚Äî –≤—ã–±–æ—Ä –∫–æ–º–∞–Ω–¥—ã, –≤–≤–æ–¥ –∏–º–µ–Ω–∏
- `StateNewTournamentName` ‚Üí `StateNewTournamentDate` ‚Üí `StateNewTournamentLocation`
- `StateResultTournament` ‚Üí `StateResultTeam` ‚Üí `StateResultPlace`
- `StateGrantUser` ‚Üí `StateGrantRole`

---

## –°–∏—Å—Ç–µ–º–∞ –∞–≥–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–î–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π **–≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤** —á–µ—Ä–µ–∑ Task tool.

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã

| subagent_type | –†–æ–ª—å | –ê—Ä—Ç–µ—Ñ–∞–∫—Ç |
|---------------|------|----------|
| `pm` | –ü—Ä–æ–¥—É–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî –¢–ó —Å user stories | `PM.md` |
| `arch` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä ‚Äî API, —Å—Ö–µ–º–∞ –ë–î | `arch.md` |
| `dev` | Go-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ ‚Äî –∫–æ–¥ –ø–æ arch.md | –∫–æ–¥ + —Ç–µ—Å—Ç—ã |
| `review` | Code Reviewer ‚Äî –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π —Ä–µ–≤—å—é | APPROVE/REJECT |
| `test` | QA ‚Äî –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, edge cases | `test.md` |

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
Task(subagent_type="dev") ‚Üí Task(subagent_type="review") + Task(subagent_type="test") (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
```

---

## –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Claude

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è

Claude **–º–æ–∂–µ—Ç –±–µ–∑ —Å–ø—Ä–æ—Å–∞**:
- –ó–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ß–∏—Ç–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
- –†–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (SELECT, INSERT, UPDATE)
- –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –∏ –ª–∏–Ω—Ç–µ—Ä
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

Claude **–ù–ï –º–æ–∂–µ—Ç –±–µ–∑ —Å–ø—Ä–æ—Å–∞**:
- –î–µ–ª–∞—Ç—å git commit
- –ü—É—à–∏—Ç—å –≤ remote —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –£–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ production

### –§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ –∏ conventional commits:
- `feat: add new feature`
- `fix: resolve bug`
- `refactor: improve code structure`
- `docs: update documentation`
- `test: add tests`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. `go build ./...` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
2. `go test ./...` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ª–∏–Ω—Ç–µ—Ä: `golangci-lint run ./...`

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:

1. –£–±–∏—Ç—å –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:
   ```bash
   pkill -9 -f "go run"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ç—ã:
   ```bash
   ps aux | grep -E "go-build.*main|go run" | grep -v grep
   ```

3. –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–ª–∏—Å—å ‚Äî —É–±–∏—Ç—å –ø–æ PID:
   ```bash
   kill -9 <PID>
   ```

**–ù–ï –∑–∞–ø—É—Å–∫–∞–π –Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø–æ–∫–∞ –Ω–µ —É–±–µ–¥–∏–ª—Å—è, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ —É–±–∏—Ç—ã!**
–ù–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞ –≤—ã–∑—ã–≤–∞—é—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

### –í–∞–ª–∏–¥–∞—Ü–∏—è

–í handlers –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫ (–º–∞–∫—Å 100-200 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã —á–∏—Å–µ–ª (–º–µ—Å—Ç–æ 1-1000)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (requireOrganizer, requireAdmin)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ FSM
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ callback handlers –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `verifyState()` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race condition –≤ FSM
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤ (–æ—Ç 1 –≥–æ–¥–∞ –Ω–∞–∑–∞–¥ –¥–æ 5 –ª–µ—Ç –≤–ø–µ—Ä—ë–¥)
